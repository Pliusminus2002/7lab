// =======================================
// 11 LAB â€“ KONTAKTÅ² FORMA
// =======================================
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("contact-form");
  if (!form) return; // jei Å¡iame puslapyje nÄ—ra formos â€“ nieko nedarom

  const resultBox = document.getElementById("form-result");
  const avgBox = document.getElementById("avg-result");
  const popup = document.getElementById("form-popup");
  const popupText = popup ? popup.querySelector(".popup-text") : null;
  const popupClose = document.getElementById("popup-close");

  function calculateAverage(q1, q2, q3) {
    return (q1 + q2 + q3) / 3;
  }

  form.addEventListener("submit", (e) => {
    e.preventDefault(); // neleidÅ¾iam puslapiui persikrauti

    const data = {
      firstName: form.firstName.value.trim(),
      lastName: form.lastName.value.trim(),
      email: form.email.value.trim(),
      phone: form.phone.value.trim(),
      address: form.address.value.trim(),
      q1: Number(form.q1.value),
      q2: Number(form.q2.value),
      q3: Number(form.q3.value),
    };

    if (!data.firstName || !data.lastName || !data.email) {
      alert("PraÅ¡au uÅ¾pildyti vardÄ…, pavardÄ™ ir el. paÅ¡tÄ….");
      return;
    }

    console.log("KontaktÅ³ formos duomenys:", data);

    if (resultBox) {
      resultBox.innerHTML = `
        <strong>Vardas:</strong> ${data.firstName}<br>
        <strong>PavardÄ—:</strong> ${data.lastName}<br>
        <strong>El. paÅ¡tas:</strong> 
          <a href="mailto:${data.email}">${data.email}</a><br>
        <strong>Tel. numeris:</strong> ${data.phone || "â€“"}<br>
        <strong>Adresas:</strong> ${data.address || "â€“"}<br>
        <strong>Vertinimai (1â€“10):</strong> ${data.q1}, ${data.q2}, ${data.q3}
      `;
    }

    const avg = calculateAverage(data.q1, data.q2, data.q3);
    if (avgBox) {
      avgBox.textContent = `${data.firstName} ${data.lastName}: vidurkis ${avg.toFixed(1)}`;
    }

    if (popup && popupText) {
      popupText.textContent = "Duomenys pateikti sÄ—kmingai!";
      popup.style.display = "flex";
    }
  });

  if (popupClose && popup) {
    popupClose.addEventListener("click", () => {
      popup.style.display = "none";
    });
  }
});


// =======================================
// 12 LAB â€“ MANO Å½AIDIMAS + PAPILDOMA
// =======================================
document.addEventListener("DOMContentLoaded", () => {
  const board = document.getElementById("game-board");
  const movesEl = document.getElementById("game-moves");
  const pairsEl = document.getElementById("game-pairs");
  const timeEl = document.getElementById("game-time");
  const msgEl = document.getElementById("game-message");
  const startBtn = document.getElementById("game-start");
  const resetBtn = document.getElementById("game-reset");
  const diffButtons = document.querySelectorAll(".game-diff-btn");
  const bestEasyEl = document.getElementById("best-easy");
  const bestHardEl = document.getElementById("best-hard");

  // jei Å¡iame puslapyje nÄ—ra Å¾aidimo â€“ iÅ¡kart iÅ¡einam
  if (!board || !startBtn) return;

  const icons = ["ğŸ’»", "ğŸ¤–", "âš™ï¸", "ğŸš€", "ğŸ“š", "ğŸ§", "ğŸ§ ", "ğŸ’¡", "ğŸ”‹", "ğŸŒŒ", "ğŸ®", "ğŸ“·"];

  let difficulty = "easy";
  let cards = [];
  let opened = [];
  let lockBoard = false;
  let moves = 0;
  let matchedPairs = 0;
  let totalPairs = 0;

  // laikmatis
  let timerId = null;
  let elapsedSec = 0;

  const LS_KEY_EASY = "memoryGameBest_easy";
  const LS_KEY_HARD = "memoryGameBest_hard";

  // ====== TIMERIS ======
  function updateTimeUI() {
    if (!timeEl) return;
    const m = Math.floor(elapsedSec / 60);
    const s = elapsedSec % 60;
    timeEl.textContent = `${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
  }

  function startTimer() {
    stopTimer();
    elapsedSec = 0;
    updateTimeUI();
    timerId = setInterval(() => {
      elapsedSec++;
      updateTimeUI();
    }, 1000);
  }

  function stopTimer() {
    if (timerId !== null) {
      clearInterval(timerId);
      timerId = null;
    }
  }

  // ====== localStorage â€“ geriausi rezultatai ======
  function loadBest(key) {
    try {
      const raw = localStorage.getItem(key);
      return raw ? JSON.parse(raw) : null;
    } catch {
      return null;
    }
  }

  function saveBest(key, data) {
    localStorage.setItem(key, JSON.stringify(data));
  }

  function formatBest(best) {
    if (!best) return "â€“";
    const m = Math.floor(best.time / 60);
    const s = best.time % 60;
    const timeStr = `${String(m).padStart(2, "0")}:${String(s).padStart(2, "0")}`;
    return `${best.moves} Ä—j., ${timeStr}`;
  }

  function refreshBestUI() {
    if (bestEasyEl) bestEasyEl.textContent = formatBest(loadBest(LS_KEY_EASY));
    if (bestHardEl) bestHardEl.textContent = formatBest(loadBest(LS_KEY_HARD));
  }

  refreshBestUI();

  // ====== KORTELIÅ² GENERAVIMAS ======
  function generateCards() {
    const pairCount = difficulty === "easy" ? 6 : 12; // easy: 6 poros, hard: 12 porÅ³
    const baseIcons = icons.slice(0, pairCount);
    const temp = [];

    baseIcons.forEach((sym) => {
      temp.push({ symbol: sym });
      temp.push({ symbol: sym });
    });

    for (let i = temp.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [temp[i], temp[j]] = [temp[j], temp[i]];
    }

    cards = temp;
    totalPairs = pairCount;
  }

  function renderBoard() {
    board.innerHTML = "";
    board.classList.toggle("easy", difficulty === "easy");
    board.classList.toggle("hard", difficulty === "hard");

    cards.forEach((card, index) => {
      const btn = document.createElement("button");
      btn.className = "game-card hidden";
      btn.dataset.index = index;
      const span = document.createElement("span");
      span.textContent = card.symbol;
      btn.appendChild(span);
      board.appendChild(btn);
    });
  }

  function resetStats() {
    moves = 0;
    matchedPairs = 0;
    opened = [];
    lockBoard = false;
    elapsedSec = 0;
    if (movesEl) movesEl.textContent = "0";
    if (pairsEl) pairsEl.textContent = "0";
    updateTimeUI();
  }

  function startGame() {
    resetStats();
    generateCards();
    renderBoard();
    if (msgEl) msgEl.textContent = "Å½aidimas pradÄ—tas! Surask visas poras.";
    startTimer(); // Äia paleidÅ¾iam laikmatÄ¯
  }

  // ====== Å½AIDIMO LOGIKA ======
  function onCardClick(e) {
    const btn = e.target.closest(".game-card");
    if (!btn || lockBoard) return;

    const index = Number(btn.dataset.index);
    if (btn.classList.contains("matched") || opened.includes(index)) return;

    btn.classList.remove("hidden");
    btn.classList.add("flipped");
    opened.push(index);

    if (opened.length === 2) {
      checkMatch();
    }
  }

  function checkMatch() {
    lockBoard = true;
    const [i1, i2] = opened;
    const c1 = cards[i1];
    const c2 = cards[i2];
    moves++;
    if (movesEl) movesEl.textContent = moves.toString();

    const btn1 = board.querySelector(`.game-card[data-index="${i1}"]`);
    const btn2 = board.querySelector(`.game-card[data-index="${i2}"]`);

    if (c1.symbol === c2.symbol) {
      matchedPairs++;
      if (pairsEl) pairsEl.textContent = matchedPairs.toString();
      if (btn1 && btn2) {
        btn1.classList.add("matched");
        btn1.classList.remove("flipped");
        btn2.classList.add("matched");
        btn2.classList.remove("flipped");
      }
      opened = [];
      lockBoard = false;

      if (matchedPairs === totalPairs) {
        stopTimer();
        if (msgEl) {
          msgEl.textContent = `LaimÄ—jote! ViskÄ… radote per ${moves} Ä—jimÅ³ per ${timeEl ? timeEl.textContent : ""}.`;
        }

        const current = { moves, time: elapsedSec };
        const key = difficulty === "easy" ? LS_KEY_EASY : LS_KEY_HARD;
        const best = loadBest(key);

        let isBetter = false;
        if (!best) isBetter = true;
        else if (current.moves < best.moves) isBetter = true;
        else if (current.moves === best.moves && current.time < best.time) isBetter = true;

        if (isBetter) {
          saveBest(key, current);
          refreshBestUI();
        }
      }
    } else {
      if (msgEl) msgEl.textContent = "Nesutapo, bandyk dar kartÄ….";
      setTimeout(() => {
        if (btn1 && btn2) {
          btn1.classList.add("hidden");
          btn1.classList.remove("flipped");
          btn2.classList.add("hidden");
          btn2.classList.remove("flipped");
        }
        opened = [];
        lockBoard = false;
      }, 800);
    }
  }

  // ====== EVENTAI ======
  diffButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      diffButtons.forEach((b) => b.classList.remove("active"));
      btn.classList.add("active");
      difficulty = btn.dataset.level === "hard" ? "hard" : "easy";
      board.innerHTML = "";
      if (msgEl) {
        msgEl.textContent = `Pasirinktas lygis: ${
          difficulty === "easy" ? "Lengvas (4Ã—3)" : "Sunkus (6Ã—4)"
        }. Paspausk â€Startâ€œ.`;
      }
    });
  });

  if (startBtn) {
    startBtn.addEventListener("click", () => {
      startGame();
    });
  }

  if (resetBtn) {
    resetBtn.addEventListener("click", () => {
      startGame();
    });
  }

  board.addEventListener("click", onCardClick);
});
